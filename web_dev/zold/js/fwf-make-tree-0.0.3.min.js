var redIcon=new L.Icon({iconUrl:"https://raw.githubusercontent.com/pointhi/leaflet-color-markers/master/img/marker-icon-2x-red.png",shadowUrl:"https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.7/images/marker-shadow.png",iconSize:[25,41],iconAnchor:[12,41],popupAnchor:[1,-34],shadowSize:[41,41]});let intimeutc=tinital;const buffer=.5;var point_list=[],file_list=[];map.doubleClickZoom.disable(),div2.className="wx-plot2",div2.setAttribute("id","wx_plot2");var btn_fire2=document.createElement("BUTTON");btn_fire2.setAttribute("id","button"),btn_fire2.className="btn_fire2",btn_fire2.innerHTML="Fire Weather",div2.appendChild(btn_fire2);var btn_wx2=document.createElement("BUTTON");let fwfclicklocation;btn_wx2.setAttribute("id","button"),btn_wx2.className="btn_wx2",btn_wx2.innerHTML="Weather",div2.appendChild(btn_wx2),fwfclicklocation=new L.marker;var searchboxControl=createSearchboxControl();const control=new searchboxControl({sidebarTitleText:"Information",sidebarMenuItems:{Items:[{type:"link",name:"Smoke Forecasts",href:"https://firesmoke.ca/",icon:"icon-fire"},{type:"link",name:"Weather Research Forecast Team",href:"https://weather.eos.ubc.ca/cgi-bin/index.cgi",icon:"icon-cloudy"},{type:"link",name:"Contact Inforamtion",href:"https://firesmoke.ca/contact/",icon:"icon-phone"},{type:"link",name:"Documentation",href:"https://cerodell.github.io/fwf-docs/index.html",icon:"icon-git"}]}});function makeplotly(e){let t=10;var o=e.target,n=o.options.customId,r=o.options.customIdx,i=o._latlng;btn_fire2.onclick=f,btn_wx2.onclick=function(){fetch(n).then(function(e){return e.json()}).then(function(e){var o=r,n=e.XLAT[o],i=e.XLONG[o],f=e.TZONE[o],c=moment.tz(Intl.DateTimeFormat().resolvedOptions().timeZone).zoneAbbr(),m=[c,"UTC","Geo Local"],s=document.createElement("select");s.setAttribute("id","mySelect"),s.className="time_wx",div2.appendChild(s);for(var u=0;u<m.length;u++){var h=document.createElement("option");h.setAttribute("value",m[u]),h.text=m[u],s.appendChild(h)}var p={},b=(e,t)=>e.map(e=>e[t]);for(var g of(keys=["dsr","ffmc","rh","isi","fwi","temp","ws","wdir","precip","dc","dmc","bui"],keys)){var m=JSON.parse(e[g]),m=b(m,o);p[g]=m}for(p.time=e.Time,p.day=e.Day,local_list2=[],arrayLength=p.time.length,u=0;u<arrayLength;u++){d=p.time[u];var _=moment.utc(d).subtract({hours:f}).format("YYYY-MM-DD HH:mm z"),v=_.slice(0,16);local_list2.push(v)}for(p.geo_time=local_list2,local_list=[],arrayLength=p.time.length,u=0;u<arrayLength;u++)a=new Date(p.time[u]+":00Z").toLocaleString(),local_list.push(moment(a).format("YYYY-MM-DD HH:mm"));if(p.local_time=local_list,s.onchange=function(){var e=this.value;if("UTC"==e)C(p.time,UTCTimeMap,intimeutc,UTCTimePlot);else if("Geo Local"==e){var t=moment.utc(UTCTimeMap).subtract({hours:f}).format("YYYY-MM-DD HH:mm z"),o=t.slice(0,16),n=moment.utc(intimeutc).subtract({hours:f}).format("YYYY-MM-DD HH:mm z"),a=n.slice(0,16),r=moment.utc(UTCTimePlot).subtract({hours:f}).format("YYYY-MM-DD HH:mm z"),i=r.slice(0,16);C(p.geo_time,o,a,i)}else if(e==c){UTCTimeMap.length<20&&(UTCTimeMap+="Z");var l=moment(new Date(UTCTimeMap).toLocaleString()).format("YYYY-MM-DD HH:mm"),m=moment(new Date(intimeutc).toLocaleString()).format("YYYY-MM-DD HH:mm"),s=moment(new Date(UTCTimePlot).toLocaleString()).format("YYYY-MM-DD HH:mm");C(p.local_time,l,m,s)}},/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))var x=320,M=400,w=50,y=30,T=60,Y=68,D=1,z=6,L=9,k=8,H=12;else var x=600,M=450,w=50,y=30,T=80,Y=100,D=2,z=11,L=10,k=9,H=14;function C(e,o,a,r){N=[temp={x:e,y:p.temp,mode:"lines",line:{color:"d62728"},yaxis:"y5",hoverlabel:{font:{size:t}},hovertemplate:"<b> Temp </b><br>%{y:.2f} (C)<br><extra></extra>"},rh={x:e,y:p.rh,mode:"lines",line:{color:"1f77b4"},yaxis:"y4",hoverlabel:{font:{size:t}},hovertemplate:"<b> RH </b><br>%{y:.2f} (%)<br><extra></extra>"},ws={x:e,y:p.ws,mode:"lines",line:{color:"202020"},yaxis:"y3",hoverlabel:{font:{size:t}},hovertemplate:"<b> WSP </b><br>%{y:.2f} (km/hr)<br><extra></extra>"},wdir={x:e,y:p.wdir,mode:"lines",line:{color:"7f7f7f"},yaxis:"y2",hoverlabel:{font:{size:t}},hovertemplate:"<b> WDIR </b><br>%{y:.2f} (deg)<br><extra></extra>"},precip={x:e,y:p.precip,mode:"lines",line:{color:"2ca02c"},yaxis:"y1",hoverlabel:{font:{size:t}},hovertemplate:"<b> Precip </b><br>%{y:.2f} (mm)<br><extra></extra>"}],S={autosize:!1,width:x,height:M,margin:{l:w,r:y,b:T,t:Y,pad:D},title:{text:"Weather Forecast <br>Lat: "+n.toString().slice(0,6)+", Lon: "+i.toString().slice(0,8),x:.05},titlefont:{color:"#444444",size:H},showlegend:!1,yaxis5:{domain:[.8,.98],title:{text:"Temp<br>(C)",font:{size:L,color:"d62728"}},tickfont:{size:k,color:"d62728"}},yaxis4:{domain:[.6,.78],title:{text:"RH<br>(%)",font:{size:L,color:"1f77b4"}},tickfont:{size:k,color:"1f77b4"}},yaxis3:{domain:[.4,.58],title:{text:"WSP<br>(km/hr)",font:{size:L,color:"202020"}},tickfont:{size:k,color:"202020"}},yaxis2:{domain:[.2,.38],title:{text:"WDIR<br>(deg)",font:{size:L,color:"7f7f7f"}},tickfont:{size:k,color:"7f7f7f"},range:[0,360],tickvals:[0,90,180,270,360]},yaxis1:{domain:[0,.18],title:{text:"Precip<br>(mm)",font:{size:L,color:"2ca02c"}},tickfont:{size:k,color:"2ca02c"}},xaxis:{tickfont:{size:z,color:"444444"}},shapes:[{type:"line",x0:o,y0:0,x1:o,yref:"paper",y1:.98,line:{color:"grey",width:1.5,dash:"dot"}},{type:"rect",xref:"x",yref:"paper",x0:a,y0:0,x1:r,y1:.98,fillcolor:"#A7A7A7",opacity:.2,line:{width:0}}]},Plotly.newPlot(l,N,S)}UTCTimeMap.length<20&&(UTCTimeMap+="Z");var A=moment(new Date(UTCTimeMap).toLocaleString()).format("YYYY-MM-DD HH:mm"),I=moment(new Date(intimeutc).toLocaleString()).format("YYYY-MM-DD HH:mm"),j=moment(new Date(UTCTimePlot).toLocaleString()).format("YYYY-MM-DD HH:mm");C(p.local_time,A,I,j)})};i.lat,i.lng;var l=document.getElementById("wx_plot2");function f(){fetch(n).then(function(e){return e.json()}).then(function(e){var o=r,n=e.XLAT[o],i=e.XLONG[o],f=e.TZONE[o],c=moment.tz(Intl.DateTimeFormat().resolvedOptions().timeZone).zoneAbbr(),m=[c,"UTC","Geo Local"],s=document.createElement("select");s.setAttribute("id","mySelect"),s.className="time_wx",div2.appendChild(s);for(var u=0;u<m.length;u++){var h=document.createElement("option");h.setAttribute("value",m[u]),h.text=m[u],s.appendChild(h)}var p={},b=(e,t)=>e.map(e=>e[t]);for(var g of(keys=["dsr","ffmc","rh","isi","fwi","temp","ws","wdir","precip","dc","dmc","bui"],keys)){m=b(m=JSON.parse(e[g]),o);p[g]=m}for(p.time=e.Time,p.day=e.Day,local_list2=[],arrayLength=p.time.length,u=0;u<arrayLength;u++){d=p.time[u]+":00:00.000Z";var _=moment.utc(d).subtract({hours:f}).format("YYYY-MM-DD HH:mm z").slice(0,16);local_list2.push(_)}for(p.geo_time=local_list2,local_list=[],arrayLength=p.time.length,u=0;u<arrayLength;u++)a=new Date(p.time[u]+":00Z").toLocaleString(),local_list.push(moment(a).format("YYYY-MM-DD HH:mm"));function v(e,o,a,r){if(/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))var f=320,c=400,m=50,s=30,d=60,u=68,h=1,b=6,g=10,_=8,v=12;else f=600,c=450,m=50,s=30,d=80,u=100,h=2,b=11,g=12,_=9,v=14;T=[["DMC","DC","BUI","FWI","DSR"],[p.dmc[0],p.dc[0],p.bui[0],p.fwi[0],p.dsr[0]],[p.dmc[1],p.dc[1],p.bui[1],p.fwi[1],p.dsr[1]]],N=(ffmc={x:e,y:p.ffmc,mode:"lines",line:{color:"ff7f0e"},yaxis:"y2",hoverlabel:{font:{size:t,color:"#ffffff"},bordercolor:"#ffffff"},hovertemplate:"<b> FFMC </b><br>%{y:.2f} <br><extra></extra>"},isi={x:e,y:p.isi,mode:"lines",line:{color:"9467bd"},yaxis:"y1",hoverlabel:{font:{size:t}},hovertemplate:"<b> ISI </b><br>%{y:.2f} <br><extra></extra>"},[{type:"table",header:{values:[["Index/Code"],[p.day[0]],[p.day[1]]],align:"center",height:18,line:{color:"444444"},fill:{color:"444444E6"},font:{family:"inherit",size:10,color:"white"}},cells:{values:T,align:"center",height:18,line:{color:"444444",width:1},fill:{color:[["#2ca02c1A","#8c564b1A","7f7f7f1A","d627281A","0000001A"]]},font:{family:"inherit",size:10,color:[["#2ca02c","#8c564b","7f7f7f","d62728","000000"]]}},xaxis:"x",yaxis:"y",domain:{x:[0,1],y:[.54,1]}},ffmc,isi]),S={autosize:!1,width:f,height:c,margin:{l:m,r:s,b:d,t:u,pad:h},title:{text:"Fire Weather Forecast <br>Lat: "+n.toString().slice(0,6)+", Lon: "+i.toString().slice(0,8),x:.05},titlefont:{color:"#444444",size:v},showlegend:!1,yaxis2:{domain:[.26,.52],title:{text:"FFMC",font:{size:g,color:"ff7f0e"}},tickfont:{size:_,color:"ff7f0e"}},yaxis1:{domain:[0,.24],title:{text:"ISI",font:{size:g,color:"9467bd"}},tickfont:{size:_,color:"9467bd"}},xaxis:{tickfont:{size:b,color:"444444"}},shapes:[{type:"line",x0:o,y0:0,x1:o,yref:"paper",y1:.52,line:{color:"grey",width:1.5,dash:"dot"}},{type:"rect",xref:"x",yref:"paper",x0:a,y0:0,x1:r,y1:.52,fillcolor:"#A7A7A7",opacity:.2,line:{width:0}}]},Plotly.newPlot(l,N,S)}p.local_time=local_list,s.onchange=function(){var e=this.value;if("UTC"==e)v(p.time,UTCTimeMap,intimeutc,UTCTimePlot);else if("Geo Local"==e){var t=moment.utc(UTCTimeMap).subtract({hours:f}).format("YYYY-MM-DD HH:mm z").slice(0,16),o=moment.utc(intimeutc).subtract({hours:f}).format("YYYY-MM-DD HH:mm z").slice(0,16),n=moment.utc(UTCTimePlot).subtract({hours:f}).format("YYYY-MM-DD HH:mm z").slice(0,16);v(p.geo_time,t,o,n)}else if(e==c){UTCTimeMap.length<20&&(UTCTimeMap+="Z");var a=moment(new Date(UTCTimeMap).toLocaleString()).format("YYYY-MM-DD HH:mm"),r=moment(new Date(intimeutc).toLocaleString()).format("YYYY-MM-DD HH:mm"),i=moment(new Date(UTCTimePlot).toLocaleString()).format("YYYY-MM-DD HH:mm");v(p.local_time,a,r,i)}},UTCTimeMap.length<20&&(UTCTimeMap+="Z");var x=moment(new Date(UTCTimeMap).toLocaleString()).format("YYYY-MM-DD HH:mm"),M=moment(new Date(intimeutc).toLocaleString()).format("YYYY-MM-DD HH:mm"),w=moment(new Date(UTCTimePlot).toLocaleString()).format("YYYY-MM-DD HH:mm");v(p.local_time,x,M,w)})}f()}var fwfmodellocation;function makeplots(e){json_dir="/static/json/fwf-zone-merge.json",fetch(json_dir,{cache:"default"}).then(function(e){return e.json()}).then(function(t){for(var o=t.ZONE_d02,n=t.XLAT_d02,a=t.XLONG_d02,r=[],i=[],l=[(l=[n.length,n[0].length])[1],l[0]],c=0;c<n.length;c++)r=r.concat(n[c]);for(c=0;c<a.length;c++)i=i.concat(a[c]);r=r.map(Number),i=i.map(Number);var m=r.map(function(e,t){return[e,i[t]]});const s=new KDBush(m);for(var d=t.ZONE_d03,u=t.XLAT_d03,h=t.XLONG_d03,p=[],b=[],g=[(g=[u.length,u[0].length])[1],g[0]],_=0;_<u.length;_++)p=p.concat(u[_]);for(_=0;_<h.length;_++)b=b.concat(h[_]);p=p.map(Number),b=b.map(Number);var v=p.map(function(e,t){return[e,b[t]]});const x=new KDBush(v);if(loaded_zones=["he"],loaded_zones_d3=["he"],/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent))var M="click";else M="dblclick";map.on(M,function(t){null!=fwfmodellocation&&fwfmodellocation.remove(map),null!=fwfclicklocation&&fwfclicklocation.remove(map),fwfclicklocation.setLatLng(t.latlng).addTo(map);var n=[parseFloat(t.latlng.lat.toFixed(4)),parseFloat(t.latlng.lng.toFixed(4))],a=s.range(n[0]-buffer,n[1]-buffer,n[0]+buffer,n[1]+buffer).map(e=>m[e]);ll_diff=[],function(e,t){for(var o=0;o<e.length;o++){var n=Math.abs(e[o][0]-t[0])+Math.abs(e[o][1]-t[1]);ll_diff.push(n)}}(a,n);for(var r=0,i=ll_diff[0],c=1;c<ll_diff.length;c++)ll_diff[c]<i&&(i=ll_diff[c],r=c);var u,h,p=s.range(n[0]-buffer,n[1]-buffer,n[0]+buffer,n[1]+buffer);f=(h=(u=l).reduce(function(e,t){return e.concat(e[e.length-1]*t)},[1]),function(e){return t=e,o=h,u.map(function(e,n){return Math.round(t/o[n])%e});var t,o});var b=function(e,t){var o=e.reduce(function(e,t){return e.concat(e[e.length-1]*t)},[1]);return e.map(function(e,n){return Math.round(t/o[n])%e})}(l,p[r],f(p[r])),_=b[1],M=b[0],w=o[_][M];if("d3"==w){var y=[parseFloat(t.latlng.lat.toFixed(4)),parseFloat(t.latlng.lng.toFixed(4))];console.log(y);var T=x.range(y[0]-buffer,y[1]-buffer,y[0]+buffer,y[1]+buffer).map(e=>v[e]);ll_diff2=[],function(e,t){for(var o=0;o<e.length;o++){var n=Math.abs(e[o][0]-t[0])+Math.abs(e[o][1]-t[1]);ll_diff2.push(n)}}(T,y);for(var Y=0,D=ll_diff2[0],z=1;z<ll_diff2.length;z++)ll_diff2[z]<D&&(D=ll_diff2[z],Y=z);var k,H=x.range(y[0]-buffer,y[1]-buffer,y[0]+buffer,y[1]+buffer);ff=((k=g).reduce(function(e,t){return e.concat(e[e.length-1]*t)},[1]),function(a){return k.map(function(a,r){return Math.round(t/o[n])%e})});var C=function(e,t){var o=e.reduce(function(e,t){return e.concat(e[e.length-1]*t)},[1]);return e.map(function(e,n){return Math.round(t/o[n])%e})}(g,H[Y],ff(H[Y])),A=C[1],I=C[0];oo=y;var S=d[A][I];zone_json_d3=e.slice(0,14),zone_json_d3=zone_json_d3+S+e.slice(16,36),fetch(zone_json_d3).then(function(e){return e.json()}).then(function(e){for(var t=e.XLAT,o=e.XLONG,n=[],a=[],r=[(r=[t.length,t[0].length])[1],r[0]],i=0;i<t.length;i++)n=n.concat(t[i]);for(i=0;i<o.length;i++)a=a.concat(o[i]);var l=t.map(function(e,t){return[e,o[t]]}),f=new KDBush(l);point_list.push(oo),file_list.push(e);var c=f.range(oo[0]-.2,oo[1]-.2,oo[0]+.2,oo[1]+.2).map(e=>l[e]);ll_diff=[],function(e,t){for(var o=0;o<e.length;o++){var n=Math.abs(parseFloat(e[o][0])-t[0])+Math.abs(parseFloat(e[o][1])-t[1]);ll_diff.push(n)}}(c,oo);var m=ll_diff.indexOf(Math.min(...ll_diff)),s=(m=f.range(oo[0]-.2,oo[1]-.2,oo[0]+.2,oo[1]+.2)[m],e.XLAT[m]),d=e.XLONG[m];console.log(zone_json_d3),(fwfmodellocation=new L.marker([s,d],{icon:redIcon,customId:zone_json_d3,customIdx:m})).bindPopup(div2,{maxWidth:"auto",maxHeight:"auto"}),fwfmodellocation.setZIndexOffset(1e3),fwfmodellocation.on("click",makeplotly).addTo(map)}),loaded_zones_d3.push(S)}else t=n,zone_json=e.slice(0,14),zone_json=zone_json+w+e.slice(16,30)+"2.json",fetch(zone_json).then(function(e){return e.json()}).then(function(e){for(var o=e.XLAT,n=e.XLONG,a=[],r=[],i=[(i=[o.length,o[0].length])[1],i[0]],l=0;l<o.length;l++)a=a.concat(o[l]);for(l=0;l<n.length;l++)r=r.concat(n[l]);var f=o.map(function(e,t){return[e,n[t]]}),c=new KDBush(f);point_list.push(t),file_list.push(e);var m=c.range(t[0]-.2,t[1]-.2,t[0]+.2,t[1]+.2).map(e=>f[e]);ll_diff=[],function(e,t){for(var o=0;o<e.length;o++){var n=Math.abs(parseFloat(e[o][0])-t[0])+Math.abs(parseFloat(e[o][1])-t[1]);ll_diff.push(n)}}(m,t);var s=ll_diff.indexOf(Math.min(...ll_diff)),d=(s=c.range(t[0]-.2,t[1]-.2,t[0]+.2,t[1]+.2)[s],e.XLAT[s]),u=e.XLONG[s];(fwfmodellocation=new L.marker([d,u],{icon:redIcon,customId:zone_json,customIdx:s})).bindPopup(div2,{maxWidth:"auto",maxHeight:"auto"}),fwfmodellocation.setZIndexOffset(1e3),fwfmodellocation.on("click",makeplotly).addTo(map)}),loaded_zones.push(w)}),control._searchfunctionCallBack=function(t){t||(t="The search call back is clicked !!"),function(t){null!=fwfmodellocation&&fwfmodellocation.remove(map),map.flyTo(t),fwfclicklocation.setLatLng(t).addTo(map);var n=[parseFloat(t[0]),parseFloat(t[1])],a=s.range(n[0]-buffer,n[1]-buffer,n[0]+buffer,n[1]+buffer).map(e=>m[e]);ll_diff=[],function(e,t){for(var o=0;o<e.length;o++){var n=Math.abs(e[o][0]-t[0])+Math.abs(e[o][1]-t[1]);ll_diff.push(n)}}(a,n);for(var r=0,i=ll_diff[0],c=1;c<ll_diff.length;c++)ll_diff[c]<i&&(i=ll_diff[c],r=c);var u,h,p=s.range(n[0]-buffer,n[1]-buffer,n[0]+buffer,n[1]+buffer);f=(h=(u=l).reduce(function(e,t){return e.concat(e[e.length-1]*t)},[1]),function(e){return t=e,o=h,u.map(function(e,n){return Math.round(t/o[n])%e});var t,o});var b=function(e,t){var o=e.reduce(function(e,t){return e.concat(e[e.length-1]*t)},[1]);return e.map(function(e,n){return Math.round(t/o[n])%e})}(l,p[r],f(p[r])),_=b[1],M=b[0],w=o[_][M];if("d3"==w){var y=[parseFloat(t[0]),parseFloat(t[1])],T=x.range(y[0]-buffer,y[1]-buffer,y[0]+buffer,y[1]+buffer).map(e=>v[e]);ll_diff2=[],function(e,t){for(var o=0;o<e.length;o++){var n=Math.abs(e[o][0]-t[0])+Math.abs(e[o][1]-t[1]);ll_diff2.push(n)}}(T,y);for(var Y=0,D=ll_diff2[0],z=1;z<ll_diff2.length;z++)ll_diff2[z]<D&&(D=ll_diff2[z],Y=z);var k,H=x.range(y[0]-buffer,y[1]-buffer,y[0]+buffer,y[1]+buffer);ff=((k=g).reduce(function(e,t){return e.concat(e[e.length-1]*t)},[1]),function(a){return k.map(function(a,r){return Math.round(t/o[n])%e})});var C=function(e,t){var o=e.reduce(function(e,t){return e.concat(e[e.length-1]*t)},[1]);return e.map(function(e,n){return Math.round(t/o[n])%e})}(g,H[Y],ff(H[Y])),A=C[1],I=C[0];oo=y;var S=d[A][I];zone_json_d3=e.slice(0,14),zone_json_d3=zone_json_d3+S+e.slice(16,36),fetch(zone_json_d3).then(function(e){return e.json()}).then(function(e){for(var t=e.XLAT,o=e.XLONG,n=[],a=[],r=[(r=[t.length,t[0].length])[1],r[0]],i=0;i<t.length;i++)n=n.concat(t[i]);for(i=0;i<o.length;i++)a=a.concat(o[i]);var l=t.map(function(e,t){return[e,o[t]]}),f=new KDBush(l);point_list.push(oo),file_list.push(e);var c=f.range(oo[0]-.2,oo[1]-.2,oo[0]+.2,oo[1]+.2).map(e=>l[e]);ll_diff=[],function(e,t){for(var o=0;o<e.length;o++){var n=Math.abs(parseFloat(e[o][0])-t[0])+Math.abs(parseFloat(e[o][1])-t[1]);ll_diff.push(n)}}(c,oo);var m=ll_diff.indexOf(Math.min(...ll_diff)),s=(m=f.range(oo[0]-.2,oo[1]-.2,oo[0]+.2,oo[1]+.2)[m],e.XLAT[m]),d=e.XLONG[m];(fwfmodellocation=new L.marker([s,d],{icon:redIcon,customId:zone_json_d3,customIdx:m})).bindPopup(div2,{maxWidth:"auto",maxHeight:"auto"}),fwfmodellocation.setZIndexOffset(1e3),fwfmodellocation.on("click",makeplotly).addTo(map)}),loaded_zones_d3.push(S)}else t=n,zone_json=e.slice(0,14),zone_json=zone_json+w+e.slice(16,30)+"2.json",fetch(zone_json).then(function(e){return e.json()}).then(function(e){console.log(e),console.log(t);for(var o=e.XLAT,n=e.XLONG,a=[],r=[],i=[(i=[o.length,o[0].length])[1],i[0]],l=0;l<o.length;l++)a=a.concat(o[l]);for(l=0;l<n.length;l++)r=r.concat(n[l]);var f=o.map(function(e,t){return[e,n[t]]}),c=new KDBush(f);point_list.push(t),file_list.push(e);var m=c.range(t[0]-.2,t[1]-.2,t[0]+.2,t[1]+.2).map(e=>f[e]);ll_diff=[],function(e,t){for(var o=0;o<e.length;o++){var n=Math.abs(parseFloat(e[o][0])-t[0])+Math.abs(parseFloat(e[o][1])-t[1]);ll_diff.push(n)}}(m,t);var s=ll_diff.indexOf(Math.min(...ll_diff)),d=(s=c.range(t[0]-.2,t[1]-.2,t[0]+.2,t[1]+.2)[s],e.XLAT[s]),u=e.XLONG[s];(fwfmodellocation=new L.marker([d,u],{icon:redIcon,customId:zone_json,customIdx:s})).bindPopup(div2,{maxWidth:"auto",maxHeight:"auto"}),fwfmodellocation.setZIndexOffset(1e3),fwfmodellocation.on("click",makeplotly).addTo(map),loaded_zones.push(w)})}(t.split(",").map(Number))},map.addControl(control)})}window.onload=function(){makeplots(json_fwf)};
