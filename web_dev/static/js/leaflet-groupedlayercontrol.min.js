L.Control.GroupedLayers=L.Control.extend({options:{collapsed:true,position:"topright",autoZIndex:true,exclusiveGroups:[],groupCheckboxes:false},initialize:function(e,d,b){var c,a;L.Util.setOptions(this,b);this._layers=[];this._lastZIndex=0;this._handlingClick=false;this._groupList=[];this._domGroups=[];for(c in e){this._addLayer(e[c],c)}for(c in d){for(a in d[c]){this._addLayer(d[c][a],a,c,true)}}},onAdd:function(a){this._initLayout();this._update();a.on("layeradd",this._onLayerChange,this).on("layerremove",this._onLayerChange,this);return this._container},onRemove:function(a){a.off("layeradd",this._onLayerChange,this).off("layerremove",this._onLayerChange,this)},addBaseLayer:function(b,a){this._addLayer(b,a);this._update();return this},addOverlay:function(b,a,c){this._addLayer(b,a,c,true);this._update();return this},removeLayer:function(a){var c=L.Util.stamp(a);var b=this._getLayer(c);if(b){delete this._layers[this._layers.indexOf(b)]}this._update();return this},_getLayer:function(b){for(var a=0;a<this._layers.length;a++){if(this._layers[a]&&L.stamp(this._layers[a].layer)===b){return this._layers[a]}}},_initLayout:function(){var b="leaflet-control-layers",a=this._container=L.DomUtil.create("div",b);a.setAttribute("aria-haspopup",true);if(L.Browser.touch){L.DomEvent.on(a,"click",L.DomEvent.stopPropagation)}else{L.DomEvent.disableClickPropagation(a);L.DomEvent.on(a,"wheel",L.DomEvent.stopPropagation)}var d=this._form=L.DomUtil.create("form",b+"-list");if(this.options.collapsed){if(!L.Browser.android){L.DomEvent.on(a,"mouseover",this._expand,this).on(a,"mouseout",this._collapse,this)}var c=this._layersLink=L.DomUtil.create("a",b+"-toggle",a);c.href="#";c.title="Layers";if(L.Browser.touch){L.DomEvent.on(c,"click",L.DomEvent.stop).on(c,"click",this._expand,this)}else{L.DomEvent.on(c,"focus",this._expand,this)}this._map.on("click",this._collapse,this)}else{this._expand()}this._baseLayersList=L.DomUtil.create("div",b+"-base",d);this._separator=L.DomUtil.create("div",b+"-separator",d);this._overlaysList=L.DomUtil.create("div",b+"-overlays",d);a.appendChild(d)},_addLayer:function(d,b,e,a){var h=L.Util.stamp(d);var g={layer:d,name:b,overlay:a};this._layers.push(g);e=e||"";var c=this._indexOf(this._groupList,e);if(c===-1){c=this._groupList.push(e)-1}var f=(this._indexOf(this.options.exclusiveGroups,e)!==-1);g.group={name:e,id:c,exclusive:f};if(this.options.autoZIndex&&d.setZIndex){this._lastZIndex++;d.setZIndex(this._lastZIndex)}},_update:function(){if(!this._container){return}this._baseLayersList.innerHTML="";this._overlaysList.innerHTML="";this._domGroups.length=0;var a=false,c=false,b,d;for(var b=0;b<this._layers.length;b++){d=this._layers[b];this._addItem(d);c=c||d.overlay;a=a||!d.overlay}this._separator.style.display=c&&a?"":"none"},_onLayerChange:function(c){var b=this._getLayer(L.Util.stamp(c.layer)),a;if(!b){return}if(!this._handlingClick){this._update()}if(b.overlay){a=c.type==="layeradd"?"overlayadd":"overlayremove"}else{a=c.type==="layeradd"?"baselayerchange":null}if(a){this._map.fire(a,b)}},_createRadioElement:function(a,d){var c='<input type="radio" class="leaflet-control-layers-selector" name="'+a+'"';if(d){c+=' checked="checked"'}c+="/>";var b=document.createElement("div");b.innerHTML=c;return b.firstChild},_addItem:function(e){var g=document.createElement("label"),h,j=this._map.hasLayer(e.layer),d,i;if(e.overlay){if(e.group.exclusive){i="leaflet-exclusive-group-layer-"+e.group.id;h=this._createRadioElement(i,j)}else{h=document.createElement("input");h.type="checkbox";h.className="leaflet-control-layers-selector";h.defaultChecked=j}}else{h=this._createRadioElement("leaflet-base-layers",j)}h.layerId=L.Util.stamp(e.layer);h.groupID=e.group.id;L.DomEvent.on(h,"click",this._onInputClick,this);var c=document.createElement("span");c.innerHTML=" "+e.name;g.appendChild(h);g.appendChild(c);if(e.overlay){d=this._overlaysList;var f=this._domGroups[e.group.id];if(!f){f=document.createElement("div");f.className="leaflet-control-layers-group";f.id="leaflet-control-layers-group-"+e.group.id;var b=document.createElement("label");b.className="leaflet-control-layers-group-label";if(e.group.name!==""&&!e.group.exclusive){if(this.options.groupCheckboxes){var a=document.createElement("input");a.type="checkbox";a.className="leaflet-control-layers-group-selector";a.groupID=e.group.id;a.legend=this;L.DomEvent.on(a,"click",this._onGroupInputClick,a);b.appendChild(a)}}var k=document.createElement("span");k.className="leaflet-control-layers-group-name";k.innerHTML=e.group.name;b.appendChild(k);f.appendChild(b);d.appendChild(f);this._domGroups[e.group.id]=f}d=f}else{d=this._baseLayersList}d.appendChild(g);return g},_onGroupInputClick:function(){var d,b,f;var c=this.legend;c._handlingClick=true;var a=c._form.getElementsByTagName("input");var e=a.length;for(d=0;d<e;d++){b=a[d];if(b.groupID===this.groupID&&b.className==="leaflet-control-layers-selector"){b.checked=this.checked;f=c._getLayer(b.layerId);if(b.checked&&!c._map.hasLayer(f.layer)){c._map.addLayer(f.layer)}else{if(!b.checked&&c._map.hasLayer(f.layer)){c._map.removeLayer(f.layer)}}}}c._handlingClick=false},_onInputClick:function(){var c,b,e,a=this._form.getElementsByTagName("input"),d=a.length;this._handlingClick=true;for(c=0;c<d;c++){b=a[c];if(b.className==="leaflet-control-layers-selector"){e=this._getLayer(b.layerId);if(b.checked&&!this._map.hasLayer(e.layer)){this._map.addLayer(e.layer)}else{if(!b.checked&&this._map.hasLayer(e.layer)){this._map.removeLayer(e.layer)}}}}this._handlingClick=false},_expand:function(){L.DomUtil.addClass(this._container,"leaflet-control-layers-expanded");var a=this._map._size.y-(this._container.offsetTop*4);if(a<this._form.clientHeight){L.DomUtil.addClass(this._form,"leaflet-control-layers-scrollbar");this._form.style.height=a+"px"}},_collapse:function(){this._container.className=this._container.className.replace(" leaflet-control-layers-expanded","")},_indexOf:function(a,d){for(var c=0,b=a.length;c<b;c++){if(a[c]===d){return c}}return -1}});L.control.groupedLayers=function(c,b,a){return new L.Control.GroupedLayers(c,b,a)};
