(function(b){var c={LOOP_CONTINUOUS:0,LOOP_ONCE:1};var j={imgNum:0,imgLen:0,epochDates:[],loopSpeed:300,loopInterval:null,currentlyLooping:false,loopFwd:true,loopType:c.LOOP_CONTINUOUS,speedChange:false,MAX_LOOP_SPEED:50,MIN_LOOP_SPEED:900,currentDatetime:null,defaultTZ:"UTC",currentTZ:"UTC",currentTZName:"UTC"};var f=["UTC","Canada/Pacific","Canada/Mountain","Canada/Central","Canada/Eastern","Canada/Atlantic","Canada/Newfoundland"];var a=function(k){return k<10?"0"+k:k};var e=function(k){paddedDateElements=[k.year(),a(k.month()+1),a(k.date())];return paddedDateElements.join("-")+" "+a(k.hour())+":"+a(k.minute())};var h=function(){var k=[];for(i in f){k.push(moment(new Date()).tz(f[i]).zoneAbbr())}j.tzOptions=k;var l="";for(i in k){l+="<option "+(j.currentTZ===f[i]?'selected="selected"':"")+' value="'+moment.tz.zone(f[i]).name+'">'+j.tzOptions[i]+"</option>"}b("#timezone-options").html(l)};var d=function(){j.currentTZ=j.defaultTZ;if(typeof(Storage)!=="undefined"){if(localStorage.getItem("timeZone")!==null){j.currentTZ=localStorage.getItem("timeZone")}}};var g=function(){if(typeof(Storage)!=="undefined"){localStorage.setItem("timeZone",j.currentTZ)}};b("#timezone-options").on("change",function(){var k=b(this).val();if(k!=j.currentTZ){j.currentTZ=k}j.currentDatetime=j.currentDatetime.tz(j.currentTZ);b("#currenttime").html(e(j.currentDatetime));g()});b("#loop-continuous").on("click",function(){if(b(this).hasClass("active")){b(this).removeClass("btn-primary").addClass("btn-default");b(this).attr("aria-pressed","false")}else{b(this).removeClass("btn-default").addClass("btn-primary");b(this).attr("aria-pressed","true")}});b.fn.slideshow=function(k){var l=[].concat.apply([],arguments).slice(1);return this.each(function(){if(k==="jump2Image"){var n=l[0];var o=b(this).data("imgPaths");var m=b(this).data("firstImg");if(j.imgNum>j.imgLen){j.imgNum=j.imgLen}else{if(j.imgNum<0){j.imgNum=0}}m.attr("src",o[n])}else{var o=[];b(this).find("img").each(function(){o.push(this.src)});b(this).data("imgPaths",o);b(this).data("firstImg",b(this).find("img").first());b(this).find(".progress-bar").attr({"aria-valuemax":o.length,"aria-valuemin":0,"aria-valuenow":o.length});var p=function(r){b(this).find(".loading-indicator").remove();b(this).trigger("loaded")}.bind(this);var q=function(s,t){var r=(s/t)*100;b(this).find(".progress-bar").removeClass("active").removeClass("progress-bar-striped").css("width",r+"%").attr("aria-valuenow",s)}.bind(this);setTimeout(function(){preloadImages(o,p,q)},0);return this}})};b.fn.multiSlideshow=function(){return this.each(function(){var m=b(this).find(".slideshow").slideshow();m.first().find("img").each(function(){j.epochDates.push(b(this).data("date"))});j.imgNum=0;j.imgLen=j.epochDates.length-1;d();h();b("#ssRangeSlider").attr({value:j.imgNum,type:"range",id:"ssRangeSlider",min:0,max:j.imgLen,step:1,title:String(j.imgNum)+"/"+String(j.imgLen)});b("#firstImage").on("click",function(){n()});b("#prevImage").on("click",function(){r()});b("#autoLoop").on("click",function(){t()});b("#nextImage").on("click",function(){s()});b("#lastImage").on("click",function(){k()});b("#increaseSpeed").on("click",function(){l()});b("#decreaseSpeed").on("click",function(){x()});b("#ssOnce").on("click",function(){A()});var v=b("#ssLoop");v.on("click",function(){A()});b("#ssRangeSlider").on("input",function(){q(b(this).val())});var q=function(C){m.slideshow("jump2Image",C);o()};var B=0;m.on("loaded",function(){B++;if(B==m.length){b("html").addClass("imagesLoaded");b("#slideshow-controls button").prop("disabled",false);b("#ssRangeSlider").prop("disabled",false);n();t()}});var A=function(){if(b("#ssOnce").is(":checked")){j.loopFwd=true;j.loopType=c.LOOP_ONCE}else{if(b("#ssLoop").is(":checked")){j.loopFwd=true;j.loopType=c.LOOP_CONTINUOUS}}};var t=function(){if(j.currentlyLooping){p()}else{j.currentlyLooping=true;b("#autoLoop span").removeClass("glyphicon-play").addClass("glyphicon-pause");if(j.imgNum>=j.imgLen&&j.loopType==c.LOOP_ONCE){j.imgNum=-1}w()}};var w=function(){j.loopFwd=true;j.loopInterval=setInterval(function(){u(1)},j.loopSpeed)};var z=function(){j.loopRev=false;j.loopInterval=setInterval(function(){u(-1)},j.loopSpeed)};var u=function(C){if(j.speedChange){j.speedChange=false;p();if(C>0){w()}else{if(C<0){z()}}}j.imgNum+=parseInt(C,10);if(j.loopType==c.LOOP_ONCE){if(j.imgNum>j.imgLen&&j.currentlyLooping){j.imgNum=j.imgLen;p()}else{if(j.imgNum>j.imgLen){j.imgNum=0}}}else{if(j.loopType==c.LOOP_CONTINUOUS){if(j.imgNum>j.imgLen){j.imgNum=0}else{if(j.imgNum<0){j.imgNum=j.imgLen}}}}b("#ssRangeSlider").prop("value",j.imgNum);q(j.imgNum)};var s=function(){if(j.currentlyLooping){p()}u(1)};var r=function(){if(j.currentlyLooping){p()}u(-1)};var n=function(){if(j.currentlyLooping){p()}j.imgNum=0;b("#ssRangeSlider").prop("value",j.imgNum);q(j.imgNum)};var k=function(){if(j.currentlyLooping){p()}j.imgNum=j.imgLen;b("#ssRangeSlider").prop("value",j.imgNum);q(j.imgNum)};var o=function(){var C=moment.tz(parseInt(j.epochDates[j.imgNum],10),"UTC");if(j.currentTZ!=j.defaultTZ){datetimeAware=C.tz(j.currentTZ)}else{datetimeAware=C}j.currentDatetime=datetimeAware;formattedDateString=e(datetimeAware);b("#currenttime").html(formattedDateString)};var l=function(){if(j.currentlyLooping){j.speedChange=true}y(-50)};var x=function(){if(j.currentlyLooping){j.speedChange=true}y(50)};var y=function(C){j.loopSpeed+=parseInt(C,10);if(j.loopSpeed<j.MAX_LOOP_SPEED){j.loopSpeed=j.MAX_LOOP_SPEED}else{if(j.loopSpeed>j.MIN_LOOP_SPEED){j.loopSpeed=j.MIN_LOOP_SPEED}}};var p=function(){j.currentlyLooping=false;b("#autoLoop span").removeClass("glyphicon-pause").addClass("glyphicon-play");window.clearInterval(j.loopInterval)}})};b(document).ready(function(){b(".master").multiSlideshow()})})(jQuery);function preloadImages(f,h,g){var a=[];var b=0;f=Object.prototype.toString.call(f)==="[object Array]"?f:[f];var d=function(){b++;this.onabort=this.onerror=this.onload=null;if(g){g(b,f.length)}if(h&&b===f.length){h(a)}};var e;for(var c=0;c<f.length;c++){e=a[c]=new Image();e.onabort=e.onerror=e.onload=d;e.src=f[c];if(e.complete){e.onabort=e.onerror=e.onload=null;d.call(e)}}};
