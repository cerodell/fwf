const fwflocation=L.marker();function makeplotly(n,t){for(var e=n.XLAT,o=n.XLONG,r=[],a=[],c=[(c=[e.length,e[0].length])[1],c[0]],l=0;l<e.length;l++)r=r.concat(e[l]);for(l=0;l<o.length;l++)a=a.concat(o[l]);var i=r.map(function(n,t){return[n,a[t]]});const u=new KDBush(i),s=u.range(t[0],t[1],t[0]+.5,t[1]+.5).map(n=>i[n]);ll_diff=[],function(n,t){for(var e=0;e<n.length;e++){var o=Math.abs(n[e][0]-t[0])+Math.abs(n[e][1]-t[1]);ll_diff.push(o)}}(s,t);var h=0,d=ll_diff[0];for(l=1;l<ll_diff.length;l++)ll_diff[l]<d&&(d=ll_diff[l],h=l);const m=u.range(t[0],t[1],t[0]+.5,t[1]+.5);var p,y;f=(y=(p=c).reduce(function(n,t){return n.concat(n[n.length-1]*t)},[1]),function(n){return function(n,t,e){return n.map(function(n,o){return Math.floor(t/e[o])%n})}(p,n,y)});var g=function(n,t){var e=n.reduce(function(n,t){return n.concat(n[n.length-1]*t)},[1]);return n.map(function(n,o){return Math.floor(t/e[o])%n})}(c,m[h],f(m[h])),x=g[1],w=g[0],_=n.XLAT[x][w],v=n.XLONG[x][w],F=n.Time,C=n.Day,D=document.getElementById("plot_fwi"),I=n.FFMC.map(function(n,t){return n[x][w]}),L=n.ISI.map(function(n,t){return n[x][w]}),M=n.FWI.map(function(n,t){return n[x][w]}),j=n.DSR.map(function(n,t){return n[x][w]}),b=n.DMC.map(function(n,t){return n[x][w]}),z=n.DC.map(function(n,t){return n[x][w]}),k=n.BUI.map(function(n,t){return n[x][w]}),T=[["DMC","DC","BUI"],[b[0],z[0],k[0]],[b[1],z[1],k[1]]],N=(I={x:F,y:I,type:"scatter",line:{color:"ff8500"},yaxis:"y4",name:"FFMC"},L={x:F,y:L,type:"scatter",line:{color:"9900cc"},yaxis:"y3",name:"ISI"},M={x:F,y:M,type:"scatter",line:{color:"0052cc"},yaxis:"y2",name:"FWI"},j={x:F,y:j,type:"scatter",line:{color:"CD2C0A"},yaxis:"y1",name:"DSR"},[{type:"table",header:{values:[["<b>Index/Code</b>"],[C[0]],[C[1]]],align:"center",line:{width:1,color:"616161"},fill:{color:"6F737C"},font:{family:"inherit",size:12,color:"white"}},cells:{values:T,align:"center",line:{color:"616161",width:1},fill:{color:[["white","white","white","white","white"]]},font:{family:"inherit",size:11,color:["616161"]}},xaxis:"x",yaxis:"y",domain:{x:[0,1],y:[.8,1]}},I,L,M,j]),S={title:"Fire Weather Forecast <br> Lat: "+_.toFixed(3)+", Long: "+v.toFixed(3),titlefont:{color:"#7f7f7f",autosize:!0},showlegend:!1,yaxis4:{domain:[.6,.8],title:{text:"FFMC",font:{color:"ff8500"}}},yaxis3:{domain:[.4,.6],title:{text:"ISI",font:{color:"9900cc"}}},yaxis2:{domain:[.2,.4],title:{text:"FWI",font:{color:"0052cc"}}},yaxis1:{domain:[0,.2],title:{text:"DSR",font:{color:"CD2C0A"}}},xaxis:{title:"Date (UTC)"}};Plotly.react(D,N,S)}function makeplots(n){json_dir="fwf-zone.json",fetch(n,{cache:"force-cache"}).then(function(n){return n.json()}).then(function(n){var t=[50.632,-120.3333];fwflocation.setLatLng(t).addTo(map),makeplotly(n,t)}),fetch(json_dir,{cache:"force-cache"}).then(function(n){return n.json()}).then(function(t){for(var e=t.ZONE,o=t.XLAT,r=t.XLONG,a=[],c=[],l=[(l=[o.length,o[0].length])[1],l[0]],i=0;i<o.length;i++)a=a.concat(o[i]);for(i=0;i<r.length;i++)c=c.concat(r[i]);a=a.map(Number),c=c.map(Number);var u=a.map(function(n,t){return[n,c[t]]});const s=new KDBush(u);map.on("click",function(t){fwflocation.setLatLng(t.latlng).addTo(map);var o=[parseFloat(t.latlng.lat.toFixed(4)),parseFloat(t.latlng.lng.toFixed(4))];const r=s.range(o[0],o[1],o[0]+.5,o[1]+.5).map(n=>u[n]);ll_diff=[],function(n,t){for(var e=0;e<n.length;e++){var o=Math.abs(n[e][0]-t[0])+Math.abs(n[e][1]-t[1]);ll_diff.push(o)}}(r,o);for(var a=0,c=ll_diff[0],i=1;i<ll_diff.length;i++)ll_diff[i]<c&&(c=ll_diff[i],a=i);const h=s.range(o[0],o[1],o[0]+.5,o[1]+.5);var d,m;f=(m=(d=l).reduce(function(n,t){return n.concat(n[n.length-1]*t)},[1]),function(n){return function(n,t,e){return n.map(function(n,o){return Math.floor(t/e[o])%n})}(d,n,m)});var p=function(n,t){var e=n.reduce(function(n,t){return n.concat(n[n.length-1]*t)},[1]);return n.map(function(n,o){return Math.floor(t/e[o])%n})}(l,h[a],f(h[a])),y=p[1],g=p[0],x=e[y][g];zone_json=n.slice(0,14),zone_json=zone_json+x+n.slice(16,32),fetch(zone_json,{cache:"force-cache"}).then(function(n){return n.json()}).then(function(n){makeplotly(n,o)})})}),window.onresize=function(){Plotly.Plots.resize(plot_fwi)}}window.onload=function(){makeplots(json_fwf)};