!function(U){if(void 0===U)throw new Error("Leaflet must be included first");U.Control.Layers.Tree=U.Control.Layers.extend({options:{closedSymbol:"+",openedSymbol:"&minus;",spaceSymbol:" ",selectorBack:!1,namedToggle:!1,collapseAll:"",expandAll:"",labelIsSelector:"both"},_initClassesNames:function(){this.cls={children:"leaflet-layerstree-children",childrenNopad:"leaflet-layerstree-children-nopad",hide:"leaflet-layerstree-hide",closed:"leaflet-layerstree-closed",opened:"leaflet-layerstree-opened",space:"leaflet-layerstree-header-space",pointer:"leaflet-layerstree-header-pointer",header:"leaflet-layerstree-header",neverShow:"leaflet-layerstree-nevershow",node:"leaflet-layerstree-node",name:"leaflet-layerstree-header-name",label:"leaflet-layerstree-header-label",selAllCheckbox:"leaflet-layerstree-sel-all-checkbox"}},initialize:function(e,t,l){this._scrollTop=0,this._initClassesNames(),this._baseTree=null,this._overlaysTree=null,U.Util.setOptions(this,l),U.Control.Layers.prototype.initialize.call(this,null,null,l),this._setTrees(e,t)},setBaseTree:function(e){return this._setTrees(e)},setOverlayTree:function(e){return this._setTrees(void 0,e)},addBaseLayer:function(e,t){throw"addBaseLayer is disabled"},collapse:function(){return this._scrollTop=this._sect().scrollTop,U.Control.Layers.prototype.collapse.call(this)},expand:function(){U.Control.Layers.prototype.expand.call(this);this._sect().scrollTop=this._scrollTop},onAdd:function(e){function t(e){e._layersTreeName&&(l.innerHTML=e._layersTreeName)}var l,s=U.Control.Layers.prototype.onAdd.call(this,e);return this.options.namedToggle&&(l=this._container.getElementsByClassName("leaflet-control-layers-toggle")[0],U.DomUtil.addClass(l,"leaflet-layerstree-named-toggle"),e.eachLayer(function(e){t(e)}),e.on("baselayerchange",function(e){t(e.layer)},this)),s},expandTree:function(e){var t=e?this._overlaysList:this._baseLayersList;return t&&this._applyOnTree(t,!1),this._localExpand()},collapseTree:function(e){var t=e?this._overlaysList:this._baseLayersList;return t&&this._applyOnTree(t,!0),this._localExpand()},expandSelected:function(e){var a=this,t=e?this._overlaysList:this._baseLayersList;if(!t)return this;for(var i=this.cls.hide,l=this._layerControlInputs||t.getElementsByTagName("input"),s=0;s<l.length;s++){var n=l[s];this._getLayer&&!!this._getLayer(n.layerId).overlay!=!!e||n.checked&&!function e(t){var l,s=t.parentElement;s&&(U.DomUtil.hasClass(s,a.cls.children)&&!U.DomUtil.hasClass(t,a.cls.childrenNopad)&&U.DomUtil.removeClass(s,i),U.DomUtil.hasClass(s,a.cls.node)&&(l=s.getElementsByClassName(a.cls.header)[0],a._applyOnTree(l,!1)),e(s))}(n.parentElement.parentElement.parentElement.parentElement)}return this._localExpand()},_sect:function(){return this._section||this._form},_setTrees:function(e,t){var s=0;function a(e,t,l){return e&&e.layer&&(l||(e.layer._layersTreeName=e.name||e.label),t[s++]=e.layer),e&&e.children&&e.children.length&&e.children.forEach(function(e){a(e,t,l)}),t}function l(e){return Array.isArray(e)?{noShow:!0,children:e}:e}this._layerControlInputs&&(this._layerControlInputs=[]);for(var i=0;i<this._layers.length;++i)this._layers[i].layer.off("add remove",this._onLayerChange,this);this._layers=[],void 0!==e&&(this._baseTree=l(e)),void 0!==t&&(this._overlaysTree=l(t));var n=a(this._baseTree,{});for(i in n)this._addLayer(n[i],i);var r=a(this._overlaysTree,{},!0);for(i in r)this._addLayer(r[i],i,!0);return this._map?this._update():this},_localExpand:function(){var e;return this._map&&U.DomUtil.hasClass(this._container,"leaflet-control-layers-expanded")&&(e=this._sect().scrollTop,this.expand(),this._sect().scrollTop=e,this._scrollTop=e),this},_applyOnTree:function(a,e){[{cls:this.cls.children,hide:e},{cls:this.cls.opened,hide:e},{cls:this.cls.closed,hide:!e}].forEach(function(e){for(var t=a.getElementsByClassName(e.cls),l=0;l<t.length;l++){var s=t[l];U.DomUtil.hasClass(s,this.cls.childrenNopad)||(e.hide?U.DomUtil.addClass(s,this.cls.hide):U.DomUtil.removeClass(s,this.cls.hide))}},this)},_addItem:function(e){},_update:function(){return this._container?(U.Control.Layers.prototype._update.call(this),this._addTreeLayout(this._baseTree,!1),this._addTreeLayout(this._overlaysTree,!0),this._localExpand()):this},_addTreeLayout:function(e,t){var l;e&&(l=t?this._overlaysList:this._baseLayersList,this._expandCollapseAll(t,this.options.collapseAll,this.collapseTree),this._expandCollapseAll(t,this.options.expandAll,this.expandTree),this._iterateTreeLayout(e,l,t,[],e.noShow),this._checkDisabledLayers&&this._checkDisabledLayers())},_expandCollapseAll:function(t,e,l,s){var a,i=t?this._overlaysList:this._baseLayersList;s=s||this,e&&((a=document.createElement("div")).className="leaflet-layerstree-expand-collapse",i.appendChild(a),a.innerHTML=e,a.tabIndex=0,U.DomEvent.on(a,"click keydown",function(e){"keydown"===e.type&&32!==e.keyCode||(a.blur(),l.call(s,t),this._localExpand())},this))},_iterateTreeLayout:function(a,i,l,s,e){if(a){var t,n=x("div",this.cls.header,i),r=x("span"),o=x("span"),c=x("span",this.cls.closed,r,this.options.closedSymbol),h=x("span",this.cls.opened,r,this.options.openedSymbol),d=x("span",this.cls.space,null,this.options.spaceSymbol);this.options.selectorBack?(r.insertBefore(d,c),n.appendChild(o),n.appendChild(r)):(r.appendChild(d),n.appendChild(r),n.appendChild(o)),a.selectAllCheckbox&&((t=this._createCheckboxElement(!1)).className+=" "+this.cls.selAllCheckbox);var p,y,u=this.cls.hide;a.children?(p=x("div",this.cls.children,i),y=a.layer?r:n,U.DomUtil.addClass(y,this.cls.pointer),y.tabIndex=0,U.DomEvent.on(y,"click keydown",function(e){"keydown"===e.type&&32!==e.keyCode||(y.blur(),U.DomUtil.hasClass(h,u)?(U.DomUtil.addClass(c,u),U.DomUtil.removeClass(h,u),U.DomUtil.removeClass(p,u)):(U.DomUtil.removeClass(c,u),U.DomUtil.addClass(h,u),U.DomUtil.addClass(p,u)),this._localExpand())},this),t&&s.splice(0,0,i),a.children.forEach(function(e){var t=x("div",this.cls.node,p);this._iterateTreeLayout(e,t,l,s)},this),t&&s.splice(0,1)):U.DomUtil.addClass(r,this.cls.neverShow);var m,_,f,v,C=x(a.layer&&("both"===this.options.labelIsSelector||l&&"overlay"===this.options.labelIsSelector||!l&&"base"===this.options.labelIsSelector)?"label":"span",this.cls.label,o);a.layer&&(m=this._map.hasLayer(a.layer),(f=l?a.radioGroup:"leaflet-base-layers_"+U.Util.stamp(this))?_=this._createRadioElement(f,m):D(_=this._createCheckboxElement(m),this),this._layerControlInputs&&this._layerControlInputs.push(_),_.layerId=U.Util.stamp(a.layer),U.DomEvent.on(_,"click",this._onInputClick,this),C.appendChild(_)),a.selectAllCheckbox&&(C.appendChild(t),("string"==typeof(v=a.selectAllCheckbox)||v instanceof String)&&(t.title=a.selectAllCheckbox),U.DomEvent.on(t,"click",function(e){e.stopPropagation(),g(t.checked,this)},this),E(i),D(t,this));x("span",this.cls.name,C,a.label);U.DomUtil.addClass(a.collapsed?h:c,u),a.collapsed&&p&&U.DomUtil.addClass(p,u),e&&(U.DomUtil.addClass(n,this.cls.neverShow),U.DomUtil.addClass(p,this.cls.childrenNopad));var b=a.eventedClasses;b instanceof Array||(b=[b]);for(var T=0;T<b.length;T++){var L,k=b[T];k&&k.className&&((L=i.querySelector("."+k.className))&&U.DomEvent.on(L,k.event||"click",function(s){return function(e){e.stopPropagation();var t,l=(t=s)&&"[object Function]"==={}.toString.call(t)?s(e,i,a,this._map):s;null!=l&&g(l,this)}}(k.selectAll),this))}}function x(e,t,l,s){var a=U.DomUtil.create(e,t,l);return s&&(a.innerHTML=s),a}function E(e){var t=e.querySelector("input[type=checkbox]"),l=!0,s=!0,a=e.querySelectorAll("input[type=checkbox]");[].forEach.call(a,function(e){e===t||(e.indeterminate?s=l=!1:e.checked?s=!1:e.checked||(l=!1))}),l?(t.indeterminate=!1,t.checked=!0):(t.indeterminate=!s,t.checked=!1)}function D(e,l){s.forEach(function(t){U.DomEvent.on(e,"click",function(e){E(t)},l)},l)}function g(e,t){for(var l=i.getElementsByTagName("input"),s=0;s<l.length;s++){var a=l[s];"checkbox"===a.type&&(a.checked=e,a.indeterminate=!1)}t._onInputClick()}},_createCheckboxElement:function(e){var t=document.createElement("input");return t.type="checkbox",t.className="leaflet-control-layers-selector",t.defaultChecked=e,t}}),U.control.layers.tree=function(e,t,l){return new U.Control.Layers.Tree(e,t,l)}}(L);